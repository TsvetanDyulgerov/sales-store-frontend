<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>App - Online Store</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.0/font/bootstrap-icons.css" rel="stylesheet">
</head>
<body class="d-flex flex-column min-vh-100">
<nav class="navbar navbar-expand-lg navbar-dark bg-dark shadow">
    <div class="container">
        <a class="navbar-brand fw-bold" href="/">Online Store</a>
        <div class="d-flex">
            <span class="navbar-text me-3" id="userWelcome"></span>
            <button class="btn btn-outline-light" id="logoutBtn">Logout</button>
        </div>
    </div>
</nav>
<main class="container mt-4 flex-grow-1">
    <!-- Error Alert Area -->
    <div id="errorAlert" class="alert alert-danger alert-dismissible fade" role="alert" style="display: none;">
        <i class="bi bi-exclamation-triangle me-2"></i>
        <span id="errorMessage"></span>
        <button type="button" class="btn-close" onclick="hideError()" aria-label="Close"></button>
    </div>

    <!-- Role-based Dashboard -->
    <div class="row mb-4">
        <div class="col-12">
            <div class="card">
                <div class="card-body">
                    <h5 class="card-title">Dashboard</h5>
                    <p class="card-text" id="roleDescription">Loading user information...</p>
                </div>
            </div>
        </div>
    </div>

    <!-- User Role Menu (Default) -->
    <div id="userMenu" class="role-menu" style="display: none;">
        <div class="row justify-content-center">
            <div class="col-lg-5 col-md-6 mb-4">
                <div class="card h-100 shadow-sm border-0">
                    <div class="card-body text-center p-4">
                        <div class="mb-3">
                            <i class="bi bi-cart-plus display-3 text-success"></i>
                        </div>
                        <h4 class="card-title text-success mb-3">Create New Order</h4>
                        <p class="card-text text-muted mb-4">Browse products and place new orders quickly and easily</p>
                        <button class="btn btn-success btn-lg px-4" onclick="navigateToSection('create-order')">
                            <i class="bi bi-plus-circle me-2"></i>Start New Order
                        </button>
                    </div>
                </div>
            </div>
            <div class="col-lg-5 col-md-6 mb-4">
                <div class="card h-100 shadow-sm border-0">
                    <div class="card-body text-center p-4">
                        <div class="mb-3">
                            <i class="bi bi-clock-history display-3 text-primary"></i>
                        </div>
                        <h4 class="card-title text-primary mb-3">Order History</h4>
                        <p class="card-text text-muted mb-4">View your past orders, track status, and manage returns</p>
                        <button class="btn btn-primary btn-lg px-4" onclick="navigateToSection('my-orders')">
                            <i class="bi bi-list-ul me-2"></i>View Orders
                        </button>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Quick Stats Row -->
        <div class="row mt-4">
            <div class="col-12">
                <div class="card border-0 bg-light">
                    <div class="card-body">
                        <h6 class="card-title text-muted mb-3">
                            <i class="bi bi-graph-up me-2"></i>Quick Overview
                        </h6>
                        <div class="row text-center">
                            <div class="col-md-4">
                                <div class="d-flex flex-column">
                                    <span class="h5 text-success mb-1" id="userTotalOrders">--</span>
                                    <small class="text-muted">Total Orders</small>
                                </div>
                            </div>
                            <div class="col-md-4">
                                <div class="d-flex flex-column">
                                    <span class="h5 text-warning mb-1" id="userPendingOrders">--</span>
                                    <small class="text-muted">Pending Orders</small>
                                </div>
                            </div>
                            <div class="col-md-4">
                                <div class="d-flex flex-column">
                                    <span class="h5 text-info mb-1" id="userRecentOrder">--</span>
                                    <small class="text-muted">Last Order</small>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Admin Role Menu -->
    <div id="adminMenu" class="role-menu" style="display: none;">
        <!-- Admin Header -->
        <div class="row mb-4">
            <div class="col-12">
                <div class="card bg-gradient-primary text-white">
                    <div class="card-body">
                        <div class="row align-items-center">
                            <div class="col">
                                <h4 class="mb-1">
                                    <i class="bi bi-shield-check me-2"></i>
                                    Administrator Dashboard
                                </h4>
                                <p class="mb-0">Manage all aspects of your online store</p>
                            </div>
                            <div class="col-auto">
                                <i class="bi bi-gear-fill fa-2x opacity-75"></i>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Management Section -->
        <div class="row mb-4">
            <div class="col-12">
                <h5 class="text-muted mb-3">
                    <i class="bi bi-tools me-2"></i>
                    Management Tools
                </h5>
            </div>
            <!-- Product Management -->
            <div class="col-md-4 mb-3">
                <div class="card h-100 border-primary">
                    <div class="card-body text-center">
                        <i class="bi bi-box-seam display-4 text-primary mb-3"></i>
                        <h5 class="card-title">Product Management</h5>
                        <p class="card-text">Add, edit, delete and manage product inventory</p>
                        <button class="btn btn-primary" onclick="navigateToSection('admin-products')">
                            <i class="bi bi-box-arrow-in-right me-2"></i>
                            Manage Products
                        </button>
                    </div>
                </div>
            </div>
            <!-- User Management -->
            <div class="col-md-4 mb-3">
                <div class="card h-100 border-warning">
                    <div class="card-body text-center">
                        <i class="bi bi-people display-4 text-warning mb-3"></i>
                        <h5 class="card-title">User Management</h5>
                        <p class="card-text">View, edit and manage customer accounts</p>
                        <button class="btn btn-warning" onclick="navigateToSection('admin-users')">
                            <i class="bi bi-person-gear me-2"></i>
                            Manage Users
                        </button>
                    </div>
                </div>
            </div>
            <!-- Order Management -->
            <div class="col-md-4 mb-3">
                <div class="card h-100 border-success">
                    <div class="card-body text-center">
                        <i class="bi bi-clipboard-data display-4 text-success mb-3"></i>
                        <h5 class="card-title">Order Management</h5>
                        <p class="card-text">View, process and track all customer orders</p>
                        <button class="btn btn-success" onclick="navigateToSection('admin-orders')">
                            <i class="bi bi-list-check me-2"></i>
                            Manage Orders
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Analytics & Reports Section -->
        <div class="row mb-4">
            <div class="col-12">
                <h5 class="text-muted mb-3">
                    <i class="bi bi-graph-up me-2"></i>
                    Analytics & Reports
                </h5>
            </div>
            <div class="col-md-6 mb-3">
                <div class="card h-100 border-info">
                    <div class="card-body text-center">
                        <i class="bi bi-bar-chart display-4 text-info mb-3"></i>
                        <h5 class="card-title">Sales Analytics</h5>
                        <p class="card-text">View sales reports and performance metrics</p>
                        <button class="btn btn-info" onclick="navigateToSection('admin-analytics')">
                            <i class="bi bi-graph-up-arrow me-2"></i>
                            View Analytics
                        </button>
                    </div>
                </div>
            </div>
            <div class="col-md-6 mb-3">
                <div class="card h-100 border-secondary">
                    <div class="card-body text-center">
                        <i class="bi bi-file-earmark-text display-4 text-secondary mb-3"></i>
                        <h5 class="card-title">System Reports</h5>
                        <p class="card-text">Generate and download system reports</p>
                        <button class="btn btn-secondary" onclick="navigateToSection('admin-reports')">
                            <i class="bi bi-download me-2"></i>
                            Generate Reports
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- System Overview Statistics -->
        <div class="row">
            <div class="col-12">
                <h5 class="text-muted mb-3">
                    <i class="bi bi-speedometer2 me-2"></i>
                    System Overview
                </h5>
            </div>
            <div class="col-12">
                <div class="card">
                    <div class="card-body">
                        <div class="row text-center">
                            <div class="col-md-3 mb-3">
                                <div class="card bg-primary text-white h-100">
                                    <div class="card-body">
                                        <i class="bi bi-box-seam fa-2x mb-2"></i>
                                        <h6>Total Products</h6>
                                        <h3 id="totalProducts">--</h3>
                                        <small>In inventory</small>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-3 mb-3">
                                <div class="card bg-warning text-white h-100">
                                    <div class="card-body">
                                        <i class="bi bi-people fa-2x mb-2"></i>
                                        <h6>Total Users</h6>
                                        <h3 id="totalUsers">--</h3>
                                        <small>Registered customers</small>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-3 mb-3">
                                <div class="card bg-success text-white h-100">
                                    <div class="card-body">
                                        <i class="bi bi-receipt fa-2x mb-2"></i>
                                        <h6>Total Orders</h6>
                                        <h3 id="totalOrders">--</h3>
                                        <small>All time</small>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-3 mb-3">
                                <div class="card bg-info text-white h-100">
                                    <div class="card-body">
                                        <i class="bi bi-currency-dollar fa-2x mb-2"></i>
                                        <h6>Revenue</h6>
                                        <h3 id="totalRevenue">$--</h3>
                                        <small>This month</small>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Content Area (for future implementation) -->
    <div id="contentArea" class="mt-4" style="display: none;">
        <div class="card">
            <div class="card-header d-flex justify-content-between align-items-center">
                <h5 class="mb-0" id="contentTitle">Content</h5>
                <button class="btn btn-secondary btn-sm" onclick="showDashboard()">
                    <i class="bi bi-arrow-left"></i> Back to Dashboard
                </button>
            </div>
            <div class="card-body" id="contentBody">
                <!-- Dynamic content will be loaded here -->
            </div>
        </div>
    </div>
</main>
<footer class="bg-dark text-light text-center py-3 mt-auto">
    <p class="mb-0">Online Store.</p>
</footer>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
<script>
    // Check authentication status
    const jwtToken = localStorage.getItem('jwtToken');
    
    if (!jwtToken) {
        // No token found, redirect to login
        window.location.href = '/login';
    }

    // Simple JWT parsing to get user info (for display purposes)
    function parseJwt(token) {
        try {
            const base64Url = token.split('.')[1];
            const base64 = base64Url.replace(/-/g, '+').replace(/_/g, '/');
            const jsonPayload = decodeURIComponent(atob(base64).split('').map(function(c) {
                return '%' + ('00' + c.charCodeAt(0).toString(16)).slice(-2);
            }).join(''));
            return JSON.parse(jsonPayload);
        } catch (error) {
            return null;
        }
    }

    // Function to get current user info from backend
    async function getCurrentUser() {
        try {
            const response = await fetch('/api/auth/me', {
                method: 'GET',
                headers: {
                    'Content-Type': 'application/json',
                    'Authorization': `Bearer ${jwtToken}`
                }
            });
            
            if (response.ok) {
                return await response.json();
            }
            return null;
        } catch (error) {
            return null;
        }
    }

    // Function to initialize user interface based on user data from backend
    async function initializeUserInterface() {
        const userWelcome = document.getElementById('userWelcome');
        const roleDescription = document.getElementById('roleDescription');
        
        const userData = await getCurrentUser();
        
        if (userData && userData.username) {
            const username = userData.username;
            const userRole = userData.role;
            
            userWelcome.textContent = `Welcome, ${username}!`;
            
            const isAdmin = userRole === 'admin' || userRole === 'ADMIN' || userRole === 'administrator';
            
            if (isAdmin) {
                document.getElementById('adminMenu').style.display = 'block';
                roleDescription.innerHTML = `<i class="bi bi-shield-check text-warning me-2"></i>Welcome, <strong>${username}</strong>! You have administrator access to manage the entire system.`;
                loadAdminStats();
            } else {
                document.getElementById('userMenu').style.display = 'block';
                roleDescription.innerHTML = `<i class="bi bi-person-circle text-primary me-2"></i>Welcome, <strong>${username}</strong>! Create orders and manage your purchase history.`;
                loadUserStats();
            }
        } else {
            const jwtUserInfo = parseJwt(jwtToken);
            const username = jwtUserInfo?.sub || 'User';
            
            userWelcome.textContent = `Welcome, ${username}!`;
            document.getElementById('userMenu').style.display = 'block';
            roleDescription.innerHTML = `<i class="bi bi-person-circle text-primary me-2"></i>Welcome, <strong>${username}</strong>! Create orders and manage your purchase history.`;
            loadUserStats();
        }
    }

    // Function to show error messages
    function showError(message) {
        const errorAlert = document.getElementById('errorAlert');
        const errorMessage = document.getElementById('errorMessage');
        errorMessage.textContent = message;
        errorAlert.style.display = 'block';
        errorAlert.classList.add('show');
    }

    // Function to hide error messages
    function hideError() {
        const errorAlert = document.getElementById('errorAlert');
        errorAlert.classList.remove('show');
        setTimeout(() => {
            errorAlert.style.display = 'none';
        }, 150);
    }

    // Function to make API requests with error handling
    async function makeRequest(url, options = {}) {
        try {
            const response = await fetch(url, options);
            
            if (response.status === 503) {
                const data = await response.json();
                if (data.serverOffline) {
                    showError('Server is currently offline. Please try again later.');
                    return null;
                }
            }
            
            if (!response.ok) {
                const data = await response.json();
                throw new Error(data.message || 'Request failed');
            }
            
            return response;
        } catch (error) {
            if (error.message.includes('fetch')) {
                showError('Unable to connect to server. Please check your connection and try again.');
            } else {
                showError(error.message);
            }
            return null;
        }
    }

    // Display user welcome message and determine role
    if (jwtToken) {
        initializeUserInterface();
    } else {
        window.location.href = '/login';
    }

    // Logout functionality
    document.getElementById('logoutBtn').addEventListener('click', () => {
        // Remove JWT token
        localStorage.removeItem('jwtToken');
        
        // Redirect to home page
        window.location.href = '/';
    });

    // Navigation functions
    function navigateToSection(section) {
        document.getElementById('userMenu').style.display = 'none';
        document.getElementById('adminMenu').style.display = 'none';
        document.getElementById('contentArea').style.display = 'block';
        
        const contentTitle = document.getElementById('contentTitle');
        const contentBody = document.getElementById('contentBody');
        
        switch(section) {
            // User sections
            case 'products':
                contentTitle.innerHTML = '<i class="bi bi-shop me-2"></i>Browse Products';
                contentBody.innerHTML = `
                    <div class="text-center">
                        <i class="bi bi-shop display-1 text-muted mb-3"></i>
                        <h4>Product Catalog</h4>
                        <p class="text-muted">Product browsing functionality will be implemented here.</p>
                        <p>Features will include:</p>
                        <ul class="list-unstyled">
                            <li><i class="bi bi-check-circle text-success me-2"></i>Product search and filtering</li>
                            <li><i class="bi bi-check-circle text-success me-2"></i>Product details and images</li>
                            <li><i class="bi bi-check-circle text-success me-2"></i>Add to cart functionality</li>
                        </ul>
                    </div>`;
                break;
            case 'create-order':
                contentTitle.innerHTML = '<i class="bi bi-cart-plus me-2"></i>Create Order';
                contentBody.innerHTML = `
                    <div class="text-center">
                        <i class="bi bi-cart-plus display-1 text-muted mb-3"></i>
                        <h4>Order Creation</h4>
                        <p class="text-muted">Order creation functionality will be implemented here.</p>
                        <p>Features will include:</p>
                        <ul class="list-unstyled">
                            <li><i class="bi bi-check-circle text-success me-2"></i>Shopping cart management</li>
                            <li><i class="bi bi-check-circle text-success me-2"></i>Order summary and checkout</li>
                            <li><i class="bi bi-check-circle text-success me-2"></i>Payment processing</li>
                        </ul>
                    </div>`;
                break;
            case 'my-orders':
                contentTitle.innerHTML = '<i class="bi bi-receipt me-2"></i>My Orders';
                contentBody.innerHTML = `
                    <div class="text-center">
                        <i class="bi bi-receipt display-1 text-muted mb-3"></i>
                        <h4>Order History</h4>
                        <p class="text-muted">User order history will be displayed here.</p>
                        <p>Features will include:</p>
                        <ul class="list-unstyled">
                            <li><i class="bi bi-check-circle text-success me-2"></i>Order status tracking</li>
                            <li><i class="bi bi-check-circle text-success me-2"></i>Order details and receipts</li>
                            <li><i class="bi bi-check-circle text-success me-2"></i>Reorder functionality</li>
                        </ul>
                    </div>`;
                break;
            
            // Admin sections
            case 'admin-products':
                contentTitle.innerHTML = '<i class="bi bi-box-seam me-2"></i>Product Management';
                contentBody.innerHTML = `
                    <div class="row">
                        <div class="col-md-6">
                            <div class="card border-primary">
                                <div class="card-header bg-primary text-white">
                                    <h6 class="mb-0"><i class="bi bi-plus-circle me-2"></i>Product Operations</h6>
                                </div>
                                <div class="card-body">
                                    <p>Comprehensive product management tools:</p>
                                    <ul class="list-unstyled">
                                        <li><i class="bi bi-check-circle text-success me-2"></i>Add new products</li>
                                        <li><i class="bi bi-check-circle text-success me-2"></i>Edit product details</li>
                                        <li><i class="bi bi-check-circle text-success me-2"></i>Manage inventory levels</li>
                                        <li><i class="bi bi-check-circle text-success me-2"></i>Set pricing and discounts</li>
                                        <li><i class="bi bi-check-circle text-success me-2"></i>Upload product images</li>
                                    </ul>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="card border-info">
                                <div class="card-header bg-info text-white">
                                    <h6 class="mb-0"><i class="bi bi-graph-up me-2"></i>Product Analytics</h6>
                                </div>
                                <div class="card-body">
                                    <p>Product performance insights:</p>
                                    <ul class="list-unstyled">
                                        <li><i class="bi bi-check-circle text-success me-2"></i>Sales performance</li>
                                        <li><i class="bi bi-check-circle text-success me-2"></i>Inventory turnover</li>
                                        <li><i class="bi bi-check-circle text-success me-2"></i>Popular products</li>
                                        <li><i class="bi bi-check-circle text-success me-2"></i>Stock alerts</li>
                                    </ul>
                                </div>
                            </div>
                        </div>
                    </div>`;
                break;
            case 'admin-users':
                contentTitle.innerHTML = '<i class="bi bi-people me-2"></i>User Management';
                contentBody.innerHTML = `
                    <div class="row">
                        <div class="col-md-6">
                            <div class="card border-warning">
                                <div class="card-header bg-warning text-white">
                                    <h6 class="mb-0"><i class="bi bi-person-gear me-2"></i>User Operations</h6>
                                </div>
                                <div class="card-body">
                                    <p>Complete user account management:</p>
                                    <ul class="list-unstyled">
                                        <li><i class="bi bi-check-circle text-success me-2"></i>View all user accounts</li>
                                        <li><i class="bi bi-check-circle text-success me-2"></i>Edit user information</li>
                                        <li><i class="bi bi-check-circle text-success me-2"></i>Manage user roles</li>
                                        <li><i class="bi bi-check-circle text-success me-2"></i>Account activation/deactivation</li>
                                        <li><i class="bi bi-check-circle text-success me-2"></i>Password reset</li>
                                    </ul>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="card border-secondary">
                                <div class="card-header bg-secondary text-white">
                                    <h6 class="mb-0"><i class="bi bi-shield-check me-2"></i>Security & Permissions</h6>
                                </div>
                                <div class="card-body">
                                    <p>User security management:</p>
                                    <ul class="list-unstyled">
                                        <li><i class="bi bi-check-circle text-success me-2"></i>Role-based access control</li>
                                        <li><i class="bi bi-check-circle text-success me-2"></i>Login activity monitoring</li>
                                        <li><i class="bi bi-check-circle text-success me-2"></i>Security settings</li>
                                        <li><i class="bi bi-check-circle text-success me-2"></i>Audit logs</li>
                                    </ul>
                                </div>
                            </div>
                        </div>
                    </div>`;
                break;
            case 'admin-orders':
                contentTitle.innerHTML = '<i class="bi bi-clipboard-data me-2"></i>Order Management';
                contentBody.innerHTML = `
                    <div class="row">
                        <div class="col-md-6">
                            <div class="card border-success">
                                <div class="card-header bg-success text-white">
                                    <h6 class="mb-0"><i class="bi bi-list-check me-2"></i>Order Processing</h6>
                                </div>
                                <div class="card-body">
                                    <p>Complete order management system:</p>
                                    <ul class="list-unstyled">
                                        <li><i class="bi bi-check-circle text-success me-2"></i>View all orders</li>
                                        <li><i class="bi bi-check-circle text-success me-2"></i>Update order status</li>
                                        <li><i class="bi bi-check-circle text-success me-2"></i>Process refunds</li>
                                        <li><i class="bi bi-check-circle text-success me-2"></i>Manage shipping</li>
                                        <li><i class="bi bi-check-circle text-success me-2"></i>Customer communications</li>
                                    </ul>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="card border-info">
                                <div class="card-header bg-info text-white">
                                    <h6 class="mb-0"><i class="bi bi-graph-up-arrow me-2"></i>Order Analytics</h6>
                                </div>
                                <div class="card-body">
                                    <p>Order performance insights:</p>
                                    <ul class="list-unstyled">
                                        <li><i class="bi bi-check-circle text-success me-2"></i>Sales trends</li>
                                        <li><i class="bi bi-check-circle text-success me-2"></i>Order fulfillment metrics</li>
                                        <li><i class="bi bi-check-circle text-success me-2"></i>Customer satisfaction</li>
                                        <li><i class="bi bi-check-circle text-success me-2"></i>Revenue reports</li>
                                    </ul>
                                </div>
                            </div>
                        </div>
                    </div>`;
                break;
            case 'admin-analytics':
                contentTitle.innerHTML = '<i class="bi bi-bar-chart me-2"></i>Sales Analytics';
                contentBody.innerHTML = `
                    <div class="row">
                        <div class="col-12 mb-4">
                            <div class="card border-info">
                                <div class="card-header bg-info text-white">
                                    <h6 class="mb-0"><i class="bi bi-graph-up me-2"></i>Sales Dashboard</h6>
                                </div>
                                <div class="card-body text-center">
                                    <i class="bi bi-bar-chart display-1 text-muted mb-3"></i>
                                    <h4>Advanced Sales Analytics</h4>
                                    <p class="text-muted">Comprehensive sales analysis and reporting tools.</p>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="card">
                                <div class="card-body">
                                    <h6><i class="bi bi-calendar-week me-2"></i>Time-based Reports</h6>
                                    <ul class="list-unstyled">
                                        <li><i class="bi bi-check-circle text-success me-2"></i>Daily sales trends</li>
                                        <li><i class="bi bi-check-circle text-success me-2"></i>Monthly comparisons</li>
                                        <li><i class="bi bi-check-circle text-success me-2"></i>Seasonal analysis</li>
                                    </ul>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="card">
                                <div class="card-body">
                                    <h6><i class="bi bi-people me-2"></i>Customer Analytics</h6>
                                    <ul class="list-unstyled">
                                        <li><i class="bi bi-check-circle text-success me-2"></i>Customer demographics</li>
                                        <li><i class="bi bi-check-circle text-success me-2"></i>Purchase behavior</li>
                                        <li><i class="bi bi-check-circle text-success me-2"></i>Lifetime value</li>
                                    </ul>
                                </div>
                            </div>
                        </div>
                    </div>`;
                break;
            case 'admin-reports':
                contentTitle.innerHTML = '<i class="bi bi-file-earmark-text me-2"></i>System Reports';
                contentBody.innerHTML = `
                    <div class="row">
                        <div class="col-12 mb-4">
                            <div class="card border-secondary">
                                <div class="card-header bg-secondary text-white">
                                    <h6 class="mb-0"><i class="bi bi-download me-2"></i>Report Generation</h6>
                                </div>
                                <div class="card-body text-center">
                                    <i class="bi bi-file-earmark-text display-1 text-muted mb-3"></i>
                                    <h4>System Reports</h4>
                                    <p class="text-muted">Generate and download comprehensive system reports.</p>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-4">
                            <div class="card">
                                <div class="card-body text-center">
                                    <i class="bi bi-file-earmark-spreadsheet text-success display-4 mb-2"></i>
                                    <h6>Financial Reports</h6>
                                    <p class="small text-muted">Revenue, profit margins, tax reports</p>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-4">
                            <div class="card">
                                <div class="card-body text-center">
                                    <i class="bi bi-file-earmark-bar-graph text-primary display-4 mb-2"></i>
                                    <h6>Inventory Reports</h6>
                                    <p class="small text-muted">Stock levels, movement, reorder points</p>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-4">
                            <div class="card">
                                <div class="card-body text-center">
                                    <i class="bi bi-file-earmark-person text-warning display-4 mb-2"></i>
                                    <h6>Customer Reports</h6>
                                    <p class="small text-muted">Customer activity, preferences, demographics</p>
                                </div>
                            </div>
                        </div>
                    </div>`;
                break;
            default:
                contentTitle.textContent = 'Unknown Section';
                contentBody.innerHTML = '<div class="text-center text-danger"><p>Section not found.</p></div>';
        }
    }
    
    // Function to show dashboard
    async function showDashboard() {
        document.getElementById('contentArea').style.display = 'none';
        
        const userData = await getCurrentUser();
        console.log('showDashboard - userData:', userData); // Debug log
        const userRole = userData?.role || 'user';
        console.log('showDashboard - userRole:', userRole); // Debug log

        const isAdmin = userRole === 'admin' || userRole === 'ADMIN' || userRole === 'administrator';
        console.log('showDashboard - isAdmin:', isAdmin); // Debug log
        
        if (isAdmin) {
            document.getElementById('adminMenu').style.display = 'block';
            document.getElementById('userMenu').style.display = 'none';
            loadAdminStats();
            console.log('showDashboard - showing admin menu'); // Debug log
        } else {
            document.getElementById('userMenu').style.display = 'block';
            document.getElementById('adminMenu').style.display = 'none';
            loadUserStats();
            console.log('showDashboard - showing user menu'); // Debug log
        }
    }
    
    // Load admin statistics
    async function loadAdminStats() {
        try {
            setTimeout(() => {
                document.getElementById('totalProducts').textContent = '--';
                document.getElementById('totalUsers').textContent = '--';
                document.getElementById('totalOrders').textContent = '--';
                document.getElementById('totalRevenue').textContent = '$--';
            }, 500);
        } catch (error) {
            showError('Failed to load statistics');
        }
    }

    // Load user statistics
    async function loadUserStats() {
        try {
            setTimeout(() => {
                // Mock data for user stats - replace with actual API calls
                document.getElementById('userTotalOrders').textContent = '12';
                document.getElementById('userPendingOrders').textContent = '2';
                document.getElementById('userRecentOrder').textContent = '3 days ago';
            }, 500);
        } catch (error) {
            showError('Failed to load user statistics');
        }
    }

    // Make functions globally available
    window.navigateToSection = navigateToSection;
    window.showDashboard = showDashboard;
    window.showError = showError;
    window.hideError = hideError;
    window.makeRequest = makeRequest;
</script>
</body>
</html>
